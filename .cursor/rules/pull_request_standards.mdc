---
description: Pull request (PR) acceptance criteria and self-check gate
alwaysApply: false
---

# Pull request standards

**When to apply:** Before marking any user facing feature as complete. Use this as the acceptance gate for all PRs that add or modify behavior.

Every such PR must pass this checklist before merge.

---

## Documentation checklist

Required (unless using the internal code exception below):

- [ ] **API docs** for public APIs  
       `apps/docs/content/reference/{feature-slug}.md`
- [ ] **User guide** if users must learn new workflows  
       `apps/docs/content/guides/{feature-slug}.md` or `apps/docs/content/concepts/{feature-slug}.md`
- [ ] **Example** in `examples/{feature-slug}.md` (or `.ipynb`) with a runnable smoke block
- [ ] **CHANGELOG.md** updated with a concise entry in the correct section
- [ ] **Temp docs deleted**  
       No `*_STATUS.md`, `*_CHECKLIST.md`, `*_SUMMARY.md`, `*_PHASE*.md`, `*_IMPLEMENTATION.md`, or similar

---

## Example validation

Each example must:

- [ ] Run top to bottom without errors
- [ ] Include a smoke block that prints tool version, seed, and platform
- [ ] Pin randomness (for example `SEED=42`, no `Date.now()` in outputs)
- [ ] Produce byte identical artifacts across two runs in the same environment
- [ ] Show equivalent CLI usage with `aligntrue` commands
- [ ] Link to the relevant API docs near the top
- [ ] Use repo data or small synthetic data only (no downloads)
- [ ] Stay under 30 sections, prefer 10 to 20

---

## API documentation validation

All public symbols affected by the PR must have:

- [ ] One line purpose statement
- [ ] Parameters with types and shapes
- [ ] Return types and shapes
- [ ] Error cases and when they occur
- [ ] Determinism notes when relevant (seeds, hashes, ordering)
- [ ] Minimal example (2 to 5 lines)
- [ ] Links to example, user guide, CLI command, and source

---

## Build and CI validation

Before merge:

- [ ] Docs site builds clean  
       `pnpm --filter docs build` (or equivalent for the docs app)
- [ ] All cross links between examples, API docs, and guides resolve
- [ ] No references to deleted or renamed files
- [ ] Type checks pass on changed packages  
       `pnpm exec tsc --noEmit -p packages/schema/tsconfig.json -p packages/cli/tsconfig.json`
- [ ] Lint passes  
       `pnpm lint`
- [ ] All tests pass  
       `pnpm test`
- [ ] Determinism gate passes for any byte stable artifact  
       run under `TZ=UTC` and compare hashes

---

## UI package validation

If the PR touches `packages/ui/src/**`:

- [ ] No asset imports (no `.svg`, `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`)
- [ ] SVGs are inline JSX or data URIs only
- [ ] Linter passes `no-asset-imports-in-ui`
- [ ] All consuming apps build clean  
       for example `pnpm --filter docs build`
- [ ] Theming uses CSS variables, not hardcoded colors
- [ ] Constraints match `implementation_specs.mdc` Section 14

---

## Internal code exception path

Use only when code is strictly internal.

All must be true:

- [ ] Code is internal utility, not part of public API
- [ ] No CLI command imports or calls it
- [ ] Comprehensive unit tests exist
- [ ] Type checks pass
- [ ] Module header includes an internal note  
       `/** @internal: rationale */`
- [ ] `CHANGELOG.md` still updated with a short note

Example:

```typescript
/** @internal: hash utility used only by manifest writer */
```

---

## Agent self check before marking "done"

Do not claim completion unless all relevant items below are true.

1. Example (if added) runs twice with byte identical outputs
2. All doc links are clicked locally and resolve
3. Docs build passes without warnings that indicate missing pages
4. No temporary `*_*.md` files remain in root or dev directories
5. `CHANGELOG.md` includes a clear user facing summary
6. All acceptance criteria in this file that apply to the change are satisfied
7. If `packages/ui` changed, zero build constraints are satisfied and enforced

If any single item fails, the feature is not done.

---

## What this prevents

- Features without examples
- Public APIs without documentation
- Non deterministic examples that contradict determinism claims
- Temp docs and status files accumulating in the repo
- Broken cross links and missing pages
- Silent user facing changes without `CHANGELOG.md` entries

---

## Enforcement model

- AI agents must not mark work complete until this checklist passes
- Human reviewers use this file as the PR review contract
- CI should run:
  - docs build
  - type check
  - lint
  - tests
  - determinism checks for stable artifacts

---

## Quick commands

### Full gate (typical baseline)

```bash
TZ=UTC pnpm test
pnpm lint
pnpm --filter docs build
```

### Determinism spot check for an export

```bash
sha256sum out/export.mdc
sha256sum out/export.mdc
# Hashes must match
```
