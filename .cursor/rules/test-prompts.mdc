---
description: Test prompts for the COMP plan
---

<!--
  READ-ONLY: This file is auto-generated by AlignTrue.
  DO NOT EDIT DIRECTLY. Changes will be overwritten.
  Edit rules in .aligntrue/rules/ instead.
-->

## Kick-Off Prompts

Use these to invoke AI-driven test execution. Each prompt triggers actual command execution in a hermetic environment.

### Layer 1: Smoke Tests

```
Execute Layer 1 (Smoke Tests) from .aligntrue/rules/cli_testing_playbook.mdc.

EXECUTION PROTOCOL:
1. Set up hermetic test environment in /tmp/aligntrue-test-{timestamp}
2. Build all workspace packages: cd /path/to/workspace && pnpm build
3. Run distribution simulation script: cd packages/cli && bash tests/scripts/test-distribution.sh
4. Set environment: TZ=UTC, NODE_ENV=test
5. Execute smoke test scenarios:
   - Distribution script verification (package creation, tarball contents)
   - CLI binary execution with absolute path
   - aligntrue --help (must return <1s)
   - aligntrue --version
   - First run with no config
6. Capture all outputs, exit codes, and execution times
7. Validate against expected behavior
8. Report findings with severity (P0-P3)
9. Clean up test environment

OUTPUT: Structured report in .internal_docs/TEST_LOG.md format with:
- Commands executed
- Pass/fail status
- Issues found with root causes
- Performance metrics
```

### Layer 2: Solo Golden Paths

```
Execute Layer 2 (Solo Golden Paths) from .aligntrue/rules/cli_testing_playbook.mdc.

EXECUTION PROTOCOL:
1. Set up hermetic test environment in /tmp/aligntrue-test-{timestamp}
2. Build command inventory from packages/cli/src/commands/
3. Execute core solo workflows:
   - Init new project → sync to agents
   - Edit AGENTS.md → sync → verify round-trip
   - Edit Cursor scope file → sync → verify IR update
   - Override rule → check changes
   - Add rule (one-time import) → validate → export
   - Add source (connected source) → sync → verify updates
4. Execute new feature workflows:
   - Ignore file management (auto-detection of format conflicts)
   - Backup creation and restoration on destructive operations
   - Config-based plugs fills (set/unset/validate formats)
5. For each workflow:
   - Run exact commands
   - Capture stdout, stderr, exit codes
   - Verify resulting files (config, IR, exports)
   - Test idempotency (run twice, compare outputs)
6. Validate against expected behavior from docs
7. Report findings with severity
8. Clean up test environment

OUTPUT: Structured report with workflow results and issues found.
```

### Layer 3: Team Golden Paths

```
Execute Layer 3 (Team Golden Paths) from .aligntrue/rules/cli_testing_playbook.mdc.

**CURRENT IMPLEMENTATION STATUS:**
The automated test file `packages/cli/tests/comprehensive/layers/layer-3-team.ts` currently implements basic team mode scenarios. The scenarios below (especially A-F) are documented as manual testing procedures in Section 3.1. To complete full Layer 3 testing, the automated test file should be expanded to implement all six git-based scenarios (A-F) using the `TeamScenario` interface and `execSync` for git commands.

EXECUTION PROTOCOL:
1. Set up git-based test environment:
   - Create bare git repository in /tmp/team-repo.git
   - Configure git user for test isolation (GIT_AUTHOR_NAME, GIT_AUTHOR_EMAIL)
   - Set up two hermetic test environments: user-a and user-b in /tmp
2. Execute team workflows:
   - Solo → team migration (user-a)
   - Git repository setup and team initialization (user-a pushes, user-b clones)
   - Remote backup setup (user-a)
   - Joining existing team via git clone (user-b)
   - Team rule changes with PR workflow (using git branch mode)
   - Personal rule changes (no approval)
   - Drift detection and resolution
   - Multi-file agent editing
   - Read-only file edit detection
3. Execute git integration testing (REQUIRED - ALL scenarios):
   - **A. Git Repository Setup and Team Initialization** - REQUIRED (See implementation status in section 3.1)
   - **B. Git Integration Modes Testing** - REQUIRED (See implementation status in section 3.1)
   - **C. Merge Conflict Scenarios** - REQUIRED (See implementation status in section 3.1)
   - **D. PR Workflow Testing** - REQUIRED (See implementation status in section 3.1)
   - **E. Git Source Update Workflows** - REQUIRED (See implementation status in section 3.1)
   - **F. Remote Backup Testing** - REQUIRED (See implementation status in section 3.1)
4. Execute team-specific new features:
   - Backup creation and restoration in team mode
   - Ignore file management in team transitions
   - Backup inheritance when cloning team repository
5. For each workflow:
   - Run exact commands in sequence
   - Capture all outputs
   - Verify lockfile generation and git commit
   - Test conflict detection (both git and lockfile conflicts)
   - Validate git operations (clone, pull, push, merge, branch)
   - Verify git integration modes work correctly
   - Verify backup directory structure and restore functionality
6. Report findings with severity
7. Clean up both test environments and bare repository

OUTPUT: Structured report with team workflow results, git operation validation, and collaboration issues.
```

### Layer 4: Command Coverage

```
Execute Layer 4 (Command Coverage) from .aligntrue/rules/cli_testing_playbook.mdc.

EXECUTION PROTOCOL:
1. Set up hermetic test environment in /tmp
2. Build complete command inventory from packages/cli/src/commands/index.ts
3. For each command exported (derive list from codebase, do NOT hardcode count):
   - Execute happy path with valid inputs
   - Test with missing required flags
   - Test with invalid inputs
   - Test with conflicting flags
   - Verify --help exists and is accurate
   - Validate exit codes (0=success, non-zero=failure)
4. Specific focus areas:
   - aligntrue status: Verify output shows exporters, sync health, mode
   - aligntrue doctor: Run health checks, verify diagnostics
   - aligntrue onboard: Generate checklist, test --ci flag with SARIF input
   - aligntrue plugs set/unset: Test format validation and fill management
   - aligntrue backup cleanup: Test cleanup with retention_days and minimum_keep
   - aligntrue backup push: Test remote backup push to configured destinations
   - aligntrue backup status: Test backup status display with file assignments
   - aligntrue add source/remote: Test new subcommand structure
   - aligntrue rules list: Test rule listing by agent
   - aligntrue remove: Test source removal from config
   - aligntrue uninstall: Test clean removal with options
5. Capture all outputs and error messages
6. Validate error messages include what/why/how
7. Report findings with severity
8. Clean up test environment

OUTPUT: Command coverage matrix with pass/fail status and issues per command.
```

### Layer 5: Statefulness

```
Execute Layer 5 (Statefulness) from .aligntrue/rules/cli_testing_playbook.mdc.

EXECUTION PROTOCOL:
1. Set up hermetic test environment in /tmp
2. Test state scenarios:
   - No config (first run)
   - Valid config
   - Corrupted config (malformed YAML)
   - Partial state (cache exists, config missing)
3. For each scenario:
   - Run commands and capture behavior
   - Verify error handling
   - Test state recovery
   - Validate cache invalidation
4. Test backup system state management:
   - Verify .aligntrue/.backups/ directory structure
   - Validate retention_days and minimum_keep configuration
   - Test backup restoration from various states
   - Verify backup cleanup respects age-based retention policy
   - Confirm concurrent operations use unique timestamps (PID-SEQ)
5. Verify state stored in documented locations
6. Report findings with severity
7. Clean up test environment

OUTPUT: State management report with scenarios tested and issues found.
```

### Layer 6: Environment Matrix

```
Execute Layer 6 (Environment Matrix) from .aligntrue/rules/cli_testing_playbook.mdc.

EXECUTION PROTOCOL:
1. Identify current platform (macOS/Linux/Windows)
2. Set up hermetic test environment in /tmp
3. Test environment variations:
   - Current shell (bash/zsh/fish/cmd/powershell)
   - Node versions (20, 22, latest)
   - Different path separators
   - CI environment simulation
4. Execute core workflows on current platform
5. Validate:
   - Commands are scriptable
   - Outputs are deterministic
   - Paths use correct separators
   - No platform-specific assumptions
6. Report platform-specific issues
7. Clean up test environment

OUTPUT: Environment compatibility report with platform-specific findings.
```

### Layer 7: Error & UX

```
Execute Layer 7 (Error & UX) from .aligntrue/rules/cli_testing_playbook.mdc.

EXECUTION PROTOCOL:
1. Set up hermetic test environment in /tmp
2. Test error scenarios:
   - Invalid commands
   - Missing required arguments
   - File not found errors
   - Permission errors
   - Network failures (if applicable)
   - Validation errors
3. For each error:
   - Capture error message
   - Verify exit code follows conventions
   - Validate message includes what/why/how
   - Check for sensitive data in logs
4. Test UX elements:
   - Progress indicators (operations >10s)
   - Deterministic outputs (same inputs → same outputs)
   - Help text accuracy
5. Report findings with severity
6. Clean up test environment

OUTPUT: Error/UX report with message quality assessment and issues found.
```

### Layer 8: Exploratory

```
Execute Layer 8 (Exploratory) from .aligntrue/rules/cli_testing_playbook.mdc.

EXECUTION PROTOCOL:
1. Set up hermetic test environment in /tmp
2. Design 10-15 strange but plausible sequences:
   - Rapid mode switches (solo → team → solo)
   - Conflicting config changes
   - Partial file deletions mid-operation
   - Race conditions (two terminals, same repo)
   - Edge cases from real usage patterns
3. For each sequence:
   - State what bug/confusion you are probing
   - Execute the commands
   - Capture actual behavior
   - Compare against expected behavior
   - Assign severity if issue found
4. Report all unexpected behaviors
5. Clean up test environment

OUTPUT: Exploratory findings report with edge cases discovered and severity.
```

### All layers: Comprehensive run

```
Execute all layers from .aligntrue/rules/cli_testing_playbook.mdc sequentially.

EXECUTION PROTOCOL:
1. Set up hermetic test environment in /tmp
2. Execute layers 1-8 in order
3. Aggregate results across all layers
4. Generate comprehensive report in .internal_docs/TEST_LOG.md
5. Provide summary with:
   - Total scenarios executed
   - Issues found by severity (P0-P3)
   - Coverage percentage
   - Gaps for next run
6. Clean up test environment

OUTPUT: Comprehensive test report with full findings and recommendations.
```
