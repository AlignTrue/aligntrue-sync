---
description: Web stack guide for Nextra documentation site (auto-applies in apps/docs/)
---

# Web stack guide

**Applies to:** `apps/docs/` documentation site only

Guide for the Nextra-based AlignTrue docs site: App Router, MDX content, `@aligntrue/ui`, and Vercel deployment. Keep it simple, fast, and boring.

---

## Core principles

1. Use Nextra defaults with minimal custom code.
2. Author content in MDX under `apps/docs/content/`.
3. Use Nextra built-in components where possible.
4. Deploy a single docs site to Vercel at the main domain.
5. Share branding via `@aligntrue/ui`.
6. Prefer changes that stay compatible with Nextra minor upgrades.

---

## Performance and best practices

- Prefer fetching data in RSC (page can still be static)
- Use next/font and next/script when applicable
- next/image above the fold should use `loading="eager"` or `priority` sparingly
- Be mindful of serialized prop size for RSC to child components

---

## Nextra 4.6 App Router setup (critical)

AlignTrue uses Nextra `nextra-theme-docs` with Next.js App Router.

### Theme config

`apps/docs/theme.config.tsx` defines the Nextra theme. Nextra auto-loads this. Do not wire it through `next.config.mjs`.

```tsx
// apps/docs/theme.config.tsx
import type { DocsThemeConfig } from "nextra-theme-docs";
import { AlignTrueLogo } from "@aligntrue/ui";

const config: DocsThemeConfig = {
  logo: <AlignTrueLogo size="md" />,
  project: {
    link: "https://github.com/AlignTrue/aligntrue",
  },
  docsRepositoryBase:
    "https://github.com/AlignTrue/aligntrue/tree/main/apps/docs",
  darkMode: true,
  navigation: true,
  search: {
    placeholder: "Search documentation...",
  },
  gitTimestamp: ({ timestamp }) => (
    <>Last updated on {timestamp.toLocaleDateString()}</>
  ),
  feedback: {
    content: "Question? Give us feedback →",
    labels: "feedback",
  },
  sidebar: {
    defaultMenuCollapseLevel: 2,
    autoCollapse: false,
    toggleButton: true,
  },
  toc: {
    backToTop: true,
  },
};

export default config;
```

### Next.js config

Use Nextra plugin. Do not set theme or themeConfig here. Those are Pages Router only.

```javascript
// apps/docs/next.config.mjs
import nextra from "nextra";

const withNextra = nextra({
  latex: true,
  search: {
    codeblocks: false,
  },
  defaultShowCopyCode: true,
});

export default withNextra({
  output: "export",
  reactStrictMode: true,
  transpilePackages: ["@aligntrue/ui"],
});
```

### App Router layout

Nextra wires most behavior automatically. Use App Router layouts and import Nextra styles once.

```tsx
// apps/docs/app/layout.tsx (root layout does NOT import styles)
import type { ReactNode } from "react";

export default function RootLayout({ children }: { children: ReactNode }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  );
}

// apps/docs/app/docs/layout.tsx (docs layout imports Nextra styles)
import "nextra-theme-docs/style.css";
import { Layout, Navbar } from "nextra-theme-docs";
import { getPageMap } from "nextra/page-map";
import themeConfig from "../../theme.config";

export default async function DocsLayout({
  children,
}: {
  children: ReactNode;
}) {
  const pageMap = await getPageMap();
  return (
    <Layout pageMap={pageMap} navbar={<Navbar {...themeConfig} />}>
      {children}
    </Layout>
  );
}
```

For nested docs layout, use Nextra primitives instead of forking theme config. Wrap, do not reimplement.

### Do not

- Add theme or themeConfig to `nextra()` options.
- Pass a themeConfig prop into `<Layout>`.
- Use legacy `createAlignTrueNextraTheme()` helpers.

If a feature is not in Nextra docs, prefer upgrading Nextra or opening an upstream issue.

---

## Nextra layout and content

### Directory structure

```
apps/docs/
  app/
    layout.tsx          # Root layout
    page.tsx            # Home page
  content/
    index.mdx           # Docs landing
    getting-started/
    concepts/
    reference/
    guides/
  mdx-components.tsx    # Shared MDX components (thin wrappers)
  theme.config.tsx      # Nextra theme config
  next.config.mjs
  vercel.json
```

### Rules

- Use `index.mdx` for section roots.
- Keep nesting shallow (max 2 to 3 levels).
- Order via folder naming when needed (e.g. `01-getting-started`).
- Navigation comes from structure and `_meta.json` files.

---

## MDX authoring

### Frontmatter

Every page:

```markdown
---
title: Getting started
description: Quick intro to AlignTrue
---

# Getting started
```

### Components

Prefer Nextra components:

```jsx
import { Callout, Cards } from "nextra/components"

<Callout type="info">This is informational.</Callout>

<Cards>
  <Cards.Card title="Core" href="/concepts/architecture" />
  <Cards.Card title="CLI" href="/reference/cli" />
</Cards>
```

### Guidelines

- Use semantic MDX, not custom divs.
- Short sections, concrete examples.
- No marketing fluff. Neutral and factual, per documentation standards.

---

## Images and media

- Use `next/image` in MDX.
- Always specify width and height.
- Prefer SVG or small assets.
- No raw `<img>` without dimensions.

```jsx
import Image from "next/image";
import hero from "./hero.png";

<Image src={hero} alt="AlignTrue overview" width={960} height={540} priority />;
```

---

## Performance budgets (docs)

### Per initial route (gzipped)

| Type          | Limit    |
| ------------- | -------- |
| JavaScript    | ≤ 150 KB |
| CSS           | ≤ 50 KB  |
| Single image  | ≤ 200 KB |
| Fonts (total) | ≤ 150 KB |

If a change exceeds a budget, explain in the PR and file a follow up.

### Web vitals targets (mobile p75)

- LCP ≤ 2.5 s
- INP ≤ 200 ms
- CLS ≤ 0.10
- TTFB ≤ 800 ms

Breaking these in production blocks release.

---

## Vercel deployment

Single docs app deployed to `aligntrue.ai`.

### Setup

- Use Vercel Development, Preview, Production envs.
- Never commit `.env*`.
- Client env vars must start with `NEXT_PUBLIC_`.
- Document env usage in `documentation.mdc`.

### Minimal vercel.json

```json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "headers": [
    {
      "source": "/(.*)",
      "headers": [{ "key": "X-Frame-Options", "value": "DENY" }]
    }
  ]
}
```

### Each PR

- Must have a Preview URL.
- Must not depend on Production-only secrets.

---

## Logging and analytics

- Use server console logs as structured lines.
- Keep browser logs minimal and non-sensitive.
- If using Vercel Analytics, wire it in `app/layout.tsx` once.
- Configure external log drains only for Production.

---

## Accessibility

- Use `plugin:jsx-a11y/recommended` for docs app.
- All interactive elements keyboard accessible.
- Respect WCAG AA contrast.
- Prefer native semantics, minimal `aria-*`.

Optional Playwright + axe check is encouraged for root and key pages.

---

## Pre merge checks for docs

Run from repo root:

```bash
pnpm lint
pnpm --filter docs build
```

### Optional

```bash
pnpm exec lhci autorun --config=apps/docs/lighthouserc.json
pnpm --filter docs exec playwright test
```

If checks fail on performance or a11y, note it in the PR with a plan.

---

## Related rules

- `architecture.mdc`
- `documentation.mdc`
- `typescript.mdc`
- `security.mdc`
- `testing.mdc`
- `pull_request_standards.mdc`
