id: "packs/base/base-rule-authoring"
version: "1.0.0"
profile: "align"
spec_version: "1"
summary: "Rule authoring guideline: clear scope, actionable directives, explicit precedence"
tags: ["meta", "rule-authoring", "governance", "paved-road"]
deps: ["packs/base/base-global"]
scope:
  applies_to: ["*"]
  includes: ["**/*.{yaml,yml,mdc}"]
rules:
  - id: "one-topic-per-rule"
    severity: "warn"
    check:
      type: "file_presence"
      inputs:
        pattern: "**/*.{yaml,yml}"
      evidence: "Rule files should be focused on single topic"
    autofix:
      hint: "Split large rules (>500 lines) into focused topics"

  - id: "explicit-scope-and-exclusions"
    severity: "error"
    check:
      type: "regex"
      inputs:
        include: ["**/*.{yaml,yml}"]
        pattern: "^scope:"
        allow: true
      evidence: "Rule missing explicit scope declaration"
    autofix:
      hint: "Add scope field declaring where rule applies"

  - id: "precedence-declared"
    severity: "warn"
    check:
      type: "regex"
      inputs:
        include: ["**/*.{yaml,yml}"]
        pattern: "(overrides|defers to|complements) @"
        allow: true
      evidence: "Rule missing precedence declaration"
    autofix:
      hint: "Add precedence field using overrides/defers/complements verbs"

integrity:
  algo: "jcs-sha256"
  value: "f7ba0665935454583c4e2f449587dcb4e44364b07fd0b2501da430d49d0e40a6"

notes: |
  Meta-rule for authoring rules.
  Precedence: complements global, docs, testing, tdd, security

guidance: |
  # Rule Authoring Guideline

  ## Core Principles

  - Write for the Agent (imperative, actionable)
  - One topic per rule
  - Declare scope and exclusions explicitly
  - Lead with hard constraints
  - Encode precedence if conflict possible

  ## Rule Structure

  Header:
  - id, version, profile, spec_version
  - summary, tags, deps
  - scope (applies_to, includes, excludes)

  Body:
  - rules: machine-checkable rules with severity
  - integrity: canonical hash
  - notes: clarifications for maintainers
  - guidance: extended documentation

  ## Precedence Encoding

  Use explicit verbs:
  - "overrides @target" - takes precedence over target
  - "defers to @target" - target takes precedence
  - "complements @target" - work together

  ## Output Contract

  When proposing rule changes:
  1. Summary of change
  2. Rationale
  3. Updated rule text only
  4. Impacted areas and precedence notes
  5. Tests or examples if relevant
  6. Conflict check

  ## Best Practices

  - Keep rules â‰¤500 lines
  - Add minimal examples
  - Prefer paved-road patterns over prohibitions
  - Reference other rules with @ notation
  - Keep diffs minimal
  - Remove obsolete parts
